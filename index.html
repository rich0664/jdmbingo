<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JDM Bingo Tracker</title>
  <style>
    /* Reset */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #121212;
      color: #e0e0e0;
      padding-bottom: 20px;
    }
    header {
      background: #1e1e1e;
      color: #fff;
      padding: 1em;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    /* Score display */
    #scoreDisplay {
      background: #1e1e1e;
      padding: 10px;
      text-align: center;
      font-size: 1.1em;
      margin: 10px auto;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
      max-width: 600px;
    }
    /* Rank tag display */
    #rankContainer {
      text-align: center;
      margin: 0 auto 10px;
      max-width: 600px;
    }
    #rankDisplay {
      display: inline-block;
      border: 8px solid #555;
      border-radius: 5px;
      padding: 10px 30px;
      margin: 10px;
      text-align: center;
      font-size: 2em;
      font-weight: bold;
      text-shadow: 0 5px 5px rgba(0,0,0,1);
      color: #fff;
      /* Background gradient using CSS variables for main and accent colors */
      background-image: repeating-linear-gradient(135deg, var(--rank-main), var(--rank-main) 10px, var(--rank-accent) 10px, var(--rank-accent) 20px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
      transition: background-image 0.3s;
    }
    /* Keyframes for diagonal stripe slide */
    @keyframes slide {
      0% { background-position: 0 0; }
      100% { background-position: 100% 0; }
    }
    /* Glow animation for JDM MASTER */
    @keyframes glow {
      0% { box-shadow: 0 0 5px rgba(255,215,0,0.8); }
      50% { box-shadow: 0 0 20px rgba(255,215,0,1); }
      100% { box-shadow: 0 0 5px rgba(255,215,0,0.8); }
    }
    /* Progress bar container */
    #progressContainer {
      background: #333;
      border-radius: 5px;
      margin: 0 auto 10px;
      max-width: 600px;
      padding: 5px;
      position: relative;
      text-align: center;
    }
    #progressBar {
      height: 20px;
      border-radius: 5px;
      width: 0%;
      transition: width 0.3s;
    }
    #progressText {
      font-size: 0.9em;
      margin-top: 5px;
    }
    /* Grid container for 5x5 layout */
    .grid-container {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      padding: 10px;
    }
    .card {
      position: relative;
      min-height: 105px; /* 25% shorter than previous */
      padding: 10px;
      border-radius: 5px;
      text-align: center;
      font-size: 0.9em;
      cursor: default;
      transition: transform 0.2s, box-shadow 0.2s, background 0.2s, border 0.2s;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.7);
    }
    .card h3 {
      margin: 0.5em 0;
      cursor: pointer;
      color: #4fc3f7;
      text-decoration: underline;
      white-space: normal;
      line-height: 1.2;
      font-size: 1.1em;
      position: relative;
      z-index: 2;
    }
    /* Rarity label: only the number in the top-left corner */
    .rarity-label {
      position: absolute;
      top: 5px;
      left: 5px;
      font-size: 0.8em;
      font-weight: bold;
      z-index: 2;
    }
    /* Large faint rarity symbol in background */
    .card::before {
      content: attr(data-rarity-symbol);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 4em;
      color: rgba(255, 255, 255, 0.07);
      white-space: nowrap;
      z-index: 1;
    }
    /* Check container occupies bottom third */
    .check-container {
      position: relative;
      width: 100%;
      height: 33%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.05);
      border-top: 1px solid rgba(255,255,255,0.1);
      cursor: pointer;
      z-index: 2;
    }
    .check-container input[type="checkbox"] {
      transform: scale(1.4);
      cursor: pointer;
    }
    /* Rarity background colors (moderately vibrant) */
    .rarity-common {
      background-color: #2c5230; /* dark greenish */
    }
    .rarity-uncommon {
      background-color: #504138; /* medium brown/olive */
    }
    .rarity-rare {
      background-color: #542c2c; /* medium dark maroon */
    }
    /* Visual indication for checked cards: border matches rarity accent */
    .card.checked {
      background-color: #2a2a2a;
      border: 2px solid transparent;
    }
    .card.checked.rarity-common {
      border-color: #4caf50;
    }
    .card.checked.rarity-uncommon {
      border-color: #d2b665;
    }
    .card.checked.rarity-rare {
      border-color: #e57373;
    }
    /* Bingo active highlight */
    .card.bingo-active {
      box-shadow: 0 0 10px 3px #ff9800;
    }
    /* Modal styling */
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background: rgba(0,0,0,0.7);
      padding-top: 60px;
    }
    .modal-content {
      background: #1e1e1e;
      margin: 5% auto;
      padding: 20px;
      border-radius: 5px;
      width: 90%;
      max-width: 500px;
      position: relative;
      color: #e0e0e0;
    }
    .modal-content h2 {
      margin-top: 0;
    }
    .close {
      position: absolute;
      top: 10px;
      right: 15px;
      color: #aaa;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover {
      color: #fff;
    }
    /* Mobile adjustments */
    @media (max-width: 480px) {
      body {
        font-size: 0.8rem;
      }
      .grid-container {
        gap: 5px;
        padding: 5px;
      }
      .card {
        padding: 5px;
        min-height: 90px;
      }
      .card h3 {
        font-size: 1em;
      }
      .check-container {
        height: 40%;
      }
      #progressText {
        font-size: 0.8em;
      }
      #rankLetter {
        font-size: 1.4em;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>JDM Bingo Tracker</h1>
  </header>

  <!-- Score & rank display -->
  <div id="scoreDisplay">Total Points: 0 | Rank: N/A</div>
  <div id="rankContainer">
    <div id="rankDisplay">
      <span id="rankLetter"></span>
    </div>
  </div>

  <!-- Progress bar -->
  <div id="progressContainer">
    <div id="progressBar"></div>
    <div id="progressText">0/25 Cars - Next Rank in 0 points</div>
  </div>

  <!-- Bingo grid -->
  <div class="grid-container" id="grid"></div>
  
  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h2 id="modalTitle"></h2>
      <p id="modalDescription"></p>
      <p><a id="modalLink" href="#" target="_blank" style="color: #64b5f6;">Google Image Search</a></p>
    </div>
  </div>
  
  <script>
    // Car data: name, rarity, rarityLabel, raritySymbol, description.
    const cars = [
      { name: "Toyota Chaser",        rarity: 1, rarityLabel: "(1)", raritySymbol: "普", description: "A legendary X-chassis sedan delivering turbocharged precision for spirited drift battles." },
      { name: "Civic Type R (Any)",     rarity: 1, rarityLabel: "(1)", raritySymbol: "普", description: "A masterclass in performance with high-revving intensity and precision-tuned handling." },
      { name: "Nissan Pike Cars",       rarity: 3, rarityLabel: "(3)", raritySymbol: "希", description: "A collection of limited-edition retro masterpieces with quirky vintage styling." },
      { name: "Toyota Starlet Glanza",  rarity: 2, rarityLabel: "(2)", raritySymbol: "珍", description: "Compact yet feisty, bursting with turbocharged energy and agile dynamics." },
      { name: "Mazda Cosmo",            rarity: 3, rarityLabel: "(3)", raritySymbol: "希", description: "An icon of luxury and innovation, fusing advanced tech with rare rotary power." },
      { name: "Nissan Skyline R32",     rarity: 2, rarityLabel: "(2)", raritySymbol: "珍", description: "Nicknamed 'Godzilla,' this '90s icon features a turbocharged RB engine and legendary AWD." },
      { name: "Toyota AE111 Levin",     rarity: 2, rarityLabel: "(2)", raritySymbol: "珍", description: "Precision-engineered for racing enthusiasts with a nimble 4A-GE engine." },
      { name: "Nissan Laurel C33",      rarity: 3, rarityLabel: "(3)", raritySymbol: "希", description: "An understated gem offering robust performance and a supple chassis." },
      { name: "Toyota Century",         rarity: 3, rarityLabel: "(3)", raritySymbol: "希", description: "The pinnacle of Japanese luxury with timeless elegance and meticulous craftsmanship." },
      { name: "Mazda RX-7 FD",         rarity: 2, rarityLabel: "(2)", raritySymbol: "珍", description: "A rotary masterpiece with sleek curves and twin-turbo performance." },
      { name: "Subaru Impreza GC8",     rarity: 1, rarityLabel: "(1)", raritySymbol: "普", description: "A rally-bred icon combining turbocharged boxer power with proven AWD." },
      { name: "Nissan 300ZX (Z32)",     rarity: 2, rarityLabel: "(2)", raritySymbol: "珍", description: "A tech-forward '90s sports coupe pairing a twin-turbo V6 with advanced HICAS steering." },
      { name: "Toyota AE86 Trueno",     rarity: 3, rarityLabel: "(3)", raritySymbol: "希", description: "Iconic and agile, igniting the drifting revolution with its lightweight frame." },
      { name: "Toyota Soarer",          rarity: 2, rarityLabel: "(2)", raritySymbol: "珍", description: "A harmonious blend of luxury and performance with refined styling and potent turbo options." },
      { name: "Mitsubishi Lancer Evo IV–VI", rarity: 1, rarityLabel: "(1)", raritySymbol: "普", description: "A rally titan channeling turbocharged fury with cutting-edge AWD technology." },
      { name: "Mitsubishi FTO/GTO",     rarity: 2, rarityLabel: "(2)", raritySymbol: "珍", description: "Contrasting thrills: nimble FTO and powerful GTO deliver dynamic performance with unique character." },
      { name: "Nissan Silvia S14",      rarity: 2, rarityLabel: "(2)", raritySymbol: "珍", description: "A drifting legend with a potent SR20DET engine and impeccable balance." },
      { name: "Nissan Stagea",          rarity: 3, rarityLabel: "(3)", raritySymbol: "希", description: "A versatile wagon blending Skyline heritage with turbocharged performance and AWD grip." },
      { name: "Toyota Sera",            rarity: 3, rarityLabel: "(3)", raritySymbol: "希", description: "Boldly futuristic with butterfly doors and a glass canopy, an avant-garde marvel on wheels." },
      { name: "Subaru SVX",             rarity: 3, rarityLabel: "(3)", raritySymbol: "希", description: "A visionary grand tourer featuring a rare flat-six and innovative window design." },
      { name: "Autozam AZ-1",           rarity: 3, rarityLabel: "(3)", raritySymbol: "希", description: "A pocket-sized dynamo with a mid-engine layout and iconic gullwing doors." },
      { name: "Honda Beat",             rarity: 2, rarityLabel: "(2)", raritySymbol: "珍", description: "Compact and charismatic, delivering engaging mid-engine performance in a featherlight Kei package." },
      { name: "Suzuki Cappuccino",      rarity: 2, rarityLabel: "(2)", raritySymbol: "珍", description: "Delightfully nimble, capturing the Kei spirit with turbocharged energy and impeccable balance." },
      { name: "Daihatsu Copen",         rarity: 1, rarityLabel: "(1)", raritySymbol: "普", description: "Charming and urban—a Kei convertible with a retractable hardtop for stylish escapes." },
      { name: "Daihatsu Midget",        rarity: 3, rarityLabel: "(3)", raritySymbol: "希", description: "Unconventional and quirky—a mini Kei pickup with utilitarian charm." }
    ];

    /* Rank thresholds with colors and diagonal stripe settings.
       Lower ranks (F, E, D) now use distinct dark gray/bluish tones.
       Higher ranks (S, SS) are golden.
    */
    const rankThresholds = [
      { rank: "F",  max: 5,   mainColor: "#2f4f4f", accentColor: "#3f5f5f", symbol: "F", duration: 20 },
      { rank: "E",  max: 10,  mainColor: "#1e3a5f", accentColor: "#2e4a6f", symbol: "E", duration: 20 },
      { rank: "D",  max: 20,  mainColor: "#2c3e50", accentColor: "#3c4e60", symbol: "D", duration: 20 },
      { rank: "C",  max: 39,  mainColor: "#4b0082", accentColor: "#5a0090", symbol: "C", duration: 15 },
      { rank: "B",  max: 100, mainColor: "#008000", accentColor: "#009000", symbol: "B", duration: 10 },
      { rank: "A",  max: 253, mainColor: "#0000ff", accentColor: "#0000ee", symbol: "A", duration: 7 },
      { rank: "S",  max: 639, mainColor: "#ffd700", accentColor: "#ffc107", symbol: "S", duration: 5 },
      { rank: "SS", max: 796, mainColor: "#ffd700", accentColor: "#ffc107", symbol: "SS", duration: 3 }
    ];
    // JDM MASTER is a special rank with its own style.

    // Build grid and attach event listeners
    function buildGrid() {
      const grid = document.getElementById("grid");
      grid.innerHTML = "";
      cars.forEach((car, index) => {
        const card = document.createElement("div");
        let rarityClass = car.rarity === 1 ? "rarity-common" : car.rarity === 2 ? "rarity-uncommon" : "rarity-rare";
        card.className = "card " + rarityClass;
        card.setAttribute("data-rarity-symbol", car.raritySymbol);
        card.innerHTML = `
          <span class="rarity-label">${car.rarityLabel}</span>
          <h3 data-index="${index}">${car.name}</h3>
          <div class="check-container">
            <input type="checkbox" id="check-${index}">
          </div>
        `;
        grid.appendChild(card);
        const saved = localStorage.getItem("car-" + index);
        const checkbox = card.querySelector("input[type='checkbox']");
        if (saved === "true") {
          checkbox.checked = true;
          card.classList.add("checked");
        }
        const container = card.querySelector(".check-container");
        container.addEventListener("click", () => {
          checkbox.checked = !checkbox.checked;
          localStorage.setItem("car-" + index, checkbox.checked);
          if (checkbox.checked) {
            card.classList.add("checked");
          } else {
            card.classList.remove("checked");
          }
          updateScore();
        });
        checkbox.addEventListener("click", (e) => {
          e.stopPropagation();
          localStorage.setItem("car-" + index, checkbox.checked);
          if (checkbox.checked) {
            card.classList.add("checked");
          } else {
            card.classList.remove("checked");
          }
          updateScore();
        });
      });
      updateScore();
    }

    // Modal logic
    const modal = document.getElementById("modal");
    const modalTitle = document.getElementById("modalTitle");
    const modalDescription = document.getElementById("modalDescription");
    const modalLink = document.getElementById("modalLink");
    const closeModal = document.getElementById("closeModal");

    function addTitleListeners() {
      document.querySelectorAll(".card h3").forEach(heading => {
        heading.addEventListener("click", function() {
          const index = this.getAttribute("data-index");
          showModal(cars[index]);
        });
      });
    }

    function showModal(car) {
      modalTitle.textContent = car.name;
      modalDescription.textContent = car.description;
      modalLink.href = "https://www.google.com/search?tbm=isch&q=" + encodeURIComponent(car.name);
      modal.style.display = "block";
    }
    closeModal.onclick = function() {
      modal.style.display = "none";
    };
    window.onclick = function(e) {
      if (e.target === modal) {
        modal.style.display = "none";
      }
    };

    // Score calculation & update
    function updateScore() {
      const checkboxes = document.querySelectorAll(".card input[type='checkbox']");
      let baseScore = 0;
      let bonusScore = 0;
      let checkedCount = 0;
      const state = [];
      checkboxes.forEach((cb, index) => {
        const isChecked = cb.checked;
        state[index] = isChecked;
        if (isChecked) {
          baseScore += cars[index].rarity;
          checkedCount++;
        }
      });

      // Clear bingo highlights
      document.querySelectorAll(".card").forEach(card => card.classList.remove("bingo-active"));

      // Define bingo lines (rows, columns, diagonals)
      const lines = [
        [0,1,2,3,4],
        [5,6,7,8,9],
        [10,11,12,13,14],
        [15,16,17,18,19],
        [20,21,22,23,24],
        [0,5,10,15,20],
        [1,6,11,16,21],
        [2,7,12,17,22],
        [3,8,13,18,23],
        [4,9,14,19,24],
        [0,6,12,18,24],
        [4,8,12,16,20]
      ];

      lines.forEach(line => {
        if (line.every(idx => state[idx])) {
          let product = 1;
          line.forEach(idx => {
            product *= cars[idx].rarity;
            const card = document.getElementById(`check-${idx}`).closest(".card");
            card.classList.add("bingo-active");
          });
          bonusScore += product;
        }
      });

      const totalScore = baseScore + bonusScore;
      const rank = getRank(totalScore);
      document.getElementById("scoreDisplay").textContent =
        `Total Points: ${totalScore} | Rank: ${rank}`;
      updateProgress(checkedCount, totalScore);
      updateRankDisplay(rank);
    }

    // Determine rank based on score
    function getRank(score) {
      const allChecked = cars.every((car, i) =>
        document.getElementById(`check-${i}`).checked
      );
      if (allChecked) return "JDM MASTER";
      if (score <= 5)   return "F";
      if (score <= 10)  return "E";
      if (score <= 20)  return "D";
      if (score <= 39)  return "C";
      if (score <= 100) return "B";
      if (score <= 253) return "A";
      if (score <= 639) return "S";
      if (score <= 796) return "SS";
      return "N/A";
    }

    // Update progress bar and text
    function updateProgress(checkedCount, totalScore) {
      const progressBar = document.getElementById("progressBar");
      const progressText = document.getElementById("progressText");
      const percent = (checkedCount / 25) * 100;
      progressBar.style.width = percent + "%";
      let currentThreshold;
      for (let i = 0; i < rankThresholds.length; i++) {
        if (totalScore <= rankThresholds[i].max) {
          currentThreshold = rankThresholds[i];
          break;
        }
      }
      let nextPoints = currentThreshold ? currentThreshold.max - totalScore + 1 : 0;
      if (totalScore >= 797) {
        nextPoints = 0;
      }
      progressText.textContent = `${checkedCount}/25 Cars - Next Rank in ${nextPoints} points`;
      const color = currentThreshold ? currentThreshold.mainColor : "#28a745";
      progressBar.style.backgroundColor = color;
    }

    // Update rank tag display
    function updateRankDisplay(rank) {
      const rankDisplay = document.getElementById("rankDisplay");
      const rankLetter = document.getElementById("rankLetter");
      // For JDM MASTER, add glow animation
      if (rank === "JDM MASTER") {
        rankLetter.textContent = "JDM MASTER";
        rankDisplay.style.backgroundImage = "repeating-linear-gradient(135deg, #ffd700, #ffd700 10px, #ffc107 10px, #ffc107 20px)";
        rankDisplay.style.animation = "glow 2s infinite";
        return;
      }
      if (rank === "N/A") {
        rankLetter.textContent = "N/A";
        rankDisplay.style.backgroundImage = "none";
        rankDisplay.style.backgroundColor = "#444";
        rankDisplay.style.animation = "";
        return;
      }
      let matched = rankThresholds.find(th => th.rank === rank);
      if (!matched) {
        rankLetter.textContent = "N/A";
        rankDisplay.style.backgroundImage = "none";
        rankDisplay.style.backgroundColor = "#444";
        rankDisplay.style.animation = "";
        return;
      }
      rankLetter.textContent = matched.symbol;
      // Set CSS variables for gradient colors
      rankDisplay.style.setProperty("--rank-main", matched.mainColor);
      rankDisplay.style.setProperty("--rank-accent", matched.accentColor);
      rankDisplay.style.backgroundImage = `repeating-linear-gradient(135deg, var(--rank-main), var(--rank-main) 10px, var(--rank-accent) 10px, var(--rank-accent) 20px)`;
      // Animate the stripes: speed depends on the rank (lower duration means faster movement)
      rankDisplay.style.animation = `slide ${matched.duration}s linear infinite`;
      // For higher ranks (S, SS), optionally add extra gloss (here we use the same animated gradient)
    }

    document.addEventListener("DOMContentLoaded", () => {
      buildGrid();
      addTitleListeners();
    });
  </script>
</body>
</html>